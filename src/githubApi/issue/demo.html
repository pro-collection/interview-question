<div class="markdown-body cache html"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;margin-bottom:5px}.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-size:20px}.markdown-body h2{padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><p>æœ¬æ–‡æ¥è‡ª<a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Fxin-tan.com%2Fpassages%2F2019-10-21-react-hooks%2F" title="https://xin-tan.com/passages/2019-10-21-react-hooks/" ref="nofollow noopener noreferrer">ã€Šä¸€æ–‡å½»åº•ææ‡‚react hooksçš„åŸç†å’Œå®ç°ã€‹</a>ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œæ¬¢è¿ç»™<a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdongyuanxin%2Fblog" title="https://github.com/dongyuanxin/blog" ref="nofollow noopener noreferrer">Githubä»“åº“</a>ä¸€ä¸ªstarã€‚</p>
  <h2 data-id="heading-0">æ‘˜è¦</h2>
  <p>å½“ä½¿ç”¨ Hook ç‰¹æ€§ç¼–å†™ç»„ä»¶çš„æ—¶å€™æ—¶å€™ï¼Œæ€»èƒ½æ„Ÿè§‰åˆ°å®ƒçš„ç®€æ´å’Œæ–¹ä¾¿ã€‚å½“ç„¶ï¼Œã€Œå¤©ä¸‹æ²¡æœ‰å…è´¹çš„åˆé¤ã€ï¼Œå®ƒç‰ºç‰²äº†å¯è¯»æ€§å¹¶ä¸”å­˜åœ¨å†…å­˜æ³„æ¼é£é™©ï¼ˆæœ€åæœ‰æåˆ°ï¼‰ã€‚ä½†è¿™å¹¶ä¸å¦¨ç¢æ¢ç´¢å®ƒçš„é­”åŠ›ã€‚</p>
  <p>åœ¨æ­£å¼å¼€å§‹å‰ï¼Œå¸Œæœ›æ‚¨è¯»è¿‡ Hook çš„æ–‡æ¡£æˆ–è€…åœ¨é¡¹ç›®ä½¿ç”¨è¿‡å®ƒã€‚ä½†å¦‚æœåªå¯¹å‡½æ•°ç¼–ç¨‹æ„Ÿå…´è¶£ï¼Œä¹Ÿå¯èƒ½æœ‰æ‰€æ”¶è·ã€‚</p>
  <p>ä¸ºäº†è®©è¡Œæ–‡æ›´æµç•…ï¼Œæˆ‘æ‰“ç®—å…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼Œè¿™äº›é—®é¢˜ä¼šåœ¨æºç å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œé€æ­¥è§£å†³ï¼š</p>
  <ul>
    <li>ğŸ¤”ï¸ useState çš„å®ç°åŸç†</li>
    <li>ğŸ¤”ï¸ ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å¾ªç¯ã€åˆ¤æ–­å†…éƒ¨ä½¿ç”¨ Hook</li>
    <li>ğŸ¤”ï¸ useEffect çš„å®ç°åŸç†</li>
    <li>ğŸ¤”ï¸ useEffect çš„åº”ç”¨åœºæ™¯</li>
    <li>ğŸ¤”ï¸ <code>Class</code> vs <code>Hooks</code></li>
  </ul>
  <p>âš ï¸ ä»£ç å‡ç”±<code>TypeScript</code>æ¥å®ç°ï¼Œæ–‡ä¸­å…¨éƒ¨ demos å‡åœ¨ <a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Fgist.github.com%2Fdongyuanxin%2F4281ee21eafdc0197d6ddea27bfbdbfd" title="https://gist.github.com/dongyuanxin/4281ee21eafdc0197d6ddea27bfbdbfd" ref="nofollow noopener noreferrer">gist.github.com/dongyuanxinâ€¦</a></p>
  <h2 data-id="heading-1">useState çš„å®ç°åŸç†</h2>
  <p>å½“è°ƒç”¨ useState çš„æ—¶å€™ï¼Œä¼šè¿”å›å½¢å¦‚ <code>(å˜é‡, å‡½æ•°)</code> çš„ä¸€ä¸ªå…ƒç¥–ã€‚å¹¶ä¸” state çš„åˆå§‹å€¼å°±æ˜¯å¤–éƒ¨è°ƒç”¨ useState çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ã€‚</p>
  <p>ç†æ¸…æ¥šäº†ä¼ å‚å’Œè¿”å›å€¼ï¼Œå†æ¥çœ‹ä¸‹ useState è¿˜åšäº†äº›ä»€ä¹ˆã€‚æ­£å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼Œå½“ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ï¼Œæ‰§è¡Œ<code>setNum</code>ï¼ŒçŠ¶æ€ num è¢«æ›´æ–°ï¼Œ<strong>å¹¶ä¸” UI è§†å›¾æ›´æ–°</strong>ã€‚æ˜¾ç„¶ï¼ŒuseState è¿”å›çš„ç”¨äºæ›´æ”¹çŠ¶æ€çš„å‡½æ•°ï¼Œè‡ªåŠ¨è°ƒç”¨äº†<code>render</code>æ–¹æ³•æ¥è§¦å‘è§†å›¾æ›´æ–°ã€‚</p>
  <pre><code lang="javascript" class="hljs language-javascript copyable"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [num, setNum] = useState &lt; number &gt; <span class="hljs-number">0</span>;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>num: {num}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num + 1)}&gt;åŠ  1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>æœ‰äº†ä¸Šé¢çš„æ¢ç´¢ï¼Œå€ŸåŠ©é—­åŒ…ï¼Œå°è£…ä¸€ä¸ª <code>setState</code> å¦‚ä¸‹ï¼š</p>
  <pre><code lang="javascript" class="hljs language-javascript copyable"><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>));
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">state</span>: any;

<span class="hljs-keyword">function</span> useState&lt;T&gt;(<span class="hljs-attr">initialState</span>: T): [T, <span class="hljs-function">(<span class="hljs-params">newState: T</span>) =&gt;</span> <span class="hljs-keyword">void</span>] {
  state = state || initialState;

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">setState</span>(<span class="hljs-params">newState: T</span>) {
    state = newState;
    <span class="hljs-title function_">render</span>();
  }

  <span class="hljs-keyword">return</span> [state, setState];
}

<span class="hljs-title function_">render</span>(); <span class="hljs-comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>è¿™æ˜¯ä¸€ä¸ªç®€æ˜“èƒ½ç”¨çš„<code>useState</code>é›å½¢äº†ã€‚å®ƒä¹Ÿè§£å†³äº†æ–‡ç« å¼€å§‹æåˆ°çš„ã€ŒğŸ¤”ï¸ useState çš„å®ç°åŸç†ã€è¿™ä¸ªé—®é¢˜ã€‚ä½†å¦‚æœåœ¨å‡½æ•°å†…å£°æ˜å¤šä¸ª stateï¼Œåœ¨å½“å‰ä»£ç ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ª state æ˜¯ç”Ÿæ•ˆçš„(è¯·çœ‹<code>state = state || initialState;</code>))ã€‚</p>
  <h2 data-id="heading-2">ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å¾ªç¯ã€åˆ¤æ–­å†…éƒ¨ä½¿ç”¨ Hook</h2>
  <p>å…ˆä¸è¦è€ƒè™‘é¢˜ç›®æåŠçš„é—®é¢˜ã€‚æ€è·¯è¿˜æ˜¯å›åˆ°å¦‚ä½•è®© useState æ”¯æŒå¤šä¸ª stateã€‚<a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2F%40ryardley%2Freact-hooks-not-magic-just-arrays-cd4f1857236e" title="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" ref="nofollow noopener noreferrer">ã€ŠReact hooks: not magic, just arraysã€‹</a>ä¸­æåŠï¼ŒReact Hook çœ‹èµ·æ¥éå¸¸ Magic çš„å®ç°ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡ Array æ¥å®ç°çš„ã€‚</p>
  <p>å‰é¢ useState çš„ç®€å•å®ç°é‡Œï¼Œåˆå§‹çš„çŠ¶æ€æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€å˜é‡ä¸­çš„ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¤šä¸ªçŠ¶æ€ï¼Œåº”è¯¥æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªä¸“é—¨çš„å…¨å±€å®¹å™¨ä¸­ã€‚è¿™ä¸ªå®¹å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªæœ´å®æ— åçš„ Array å¯¹è±¡ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
  <ul>
    <li>ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶å€™ï¼Œæ ¹æ® useState é¡ºåºï¼Œé€ä¸ªå£°æ˜ state å¹¶ä¸”å°†å…¶æ”¾å…¥å…¨å±€ Array ä¸­ã€‚æ¯æ¬¡å£°æ˜ stateï¼Œéƒ½è¦å°† cursor å¢åŠ  1ã€‚</li>
    <li>æ›´æ–° stateï¼Œè§¦å‘å†æ¬¡æ¸²æŸ“çš„æ—¶å€™ã€‚<strong>cursor è¢«é‡ç½®ä¸º 0</strong>ã€‚æŒ‰ç…§ useState çš„å£°æ˜é¡ºåºï¼Œä¾æ¬¡æ‹¿å‡ºæœ€æ–°çš„ state çš„å€¼ï¼Œè§†å›¾æ›´æ–°ã€‚</li>
  </ul>
  <p>è¯·çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼Œæ¯æ¬¡ä½¿ç”¨ useStateï¼Œéƒ½ä¼šå‘ STATE å®¹å™¨ä¸­æ·»åŠ æ–°çš„çŠ¶æ€ã€‚</p>
  <p></p><figure><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/22/16df33d45b7c0214~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" loading="lazy" class="medium-zoom-image"><figcaption></figcaption></figure><p></p>
  <p>å®ç°çš„ä»£ç å¦‚ä¸‹ï¼š</p>
  <pre><code lang="typescript" class="hljs language-typescript copyable"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">states</span>: <span class="hljs-built_in">any</span>[] = [];
<span class="hljs-keyword">let</span> <span class="hljs-attr">cursor</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> useState&lt;T&gt;(<span class="hljs-attr">initialState</span>: T): [T, <span class="hljs-function">(<span class="hljs-params">newState: T</span>) =&gt;</span> <span class="hljs-built_in">void</span>] {
  <span class="hljs-keyword">const</span> currenCursor = cursor;
  states[currenCursor] = states[currenCursor] || initialState; <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ¸²æŸ“è¿‡</span>

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">setState</span>(<span class="hljs-params">newState: T</span>) {
    states[currenCursor] = newState;
    <span class="hljs-title function_">render</span>();
  }

  ++cursor; <span class="hljs-comment">// update: cursor</span>
  <span class="hljs-keyword">return</span> [states[currenCursor], setState];
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [num, setNum] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> [num2, setNum2] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">1</span>;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>num: {num}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num + 1)}&gt;åŠ  1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num - 1)}&gt;å‡ 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>num2: {num2}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum2(num2 * 2)}&gt;æ‰©å¤§ä¸€å€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum2(num2 / 2)}&gt;ç¼©å°ä¸€å€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>));
  cursor = <span class="hljs-number">0</span>; <span class="hljs-comment">// é‡ç½®cursor</span>
}

<span class="hljs-title function_">render</span>(); <span class="hljs-comment">// é¦–æ¬¡æ¸²æŸ“</span>
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>æ­¤æ—¶ï¼Œå¦‚æœæƒ³åœ¨å¾ªç¯ã€åˆ¤æ–­ç­‰ä¸åœ¨å‡½æ•°ç»„ä»¶é¡¶éƒ¨çš„åœ°æ–¹ä½¿ç”¨ Hookï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
  <pre><code lang="typescript" class="hljs language-typescript copyable"><span class="hljs-keyword">let</span> tag = <span class="hljs-literal">true</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [num, setNum] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">0</span>;

  <span class="hljs-comment">// åªæœ‰åˆæ¬¡æ¸²æŸ“ï¼Œæ‰æ‰§è¡Œ</span>
  <span class="hljs-keyword">if</span> (tag) {
    <span class="hljs-keyword">const</span> [unusedNum] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">1</span>;
    tag = <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">const</span> [num2, setNum2] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">2</span>;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>num: {num}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num + 1)}&gt;åŠ  1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num - 1)}&gt;å‡ 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>num2: {num2}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum2(num2 * 2)}&gt;æ‰©å¤§ä¸€å€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum2(num2 / 2)}&gt;ç¼©å°ä¸€å€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>ç”±äºåœ¨æ¡ä»¶åˆ¤æ–­çš„é€»è¾‘ä¸­ï¼Œé‡ç½®äº†<code>tag=false</code>ï¼Œå› æ­¤æ­¤åçš„æ¸²æŸ“ä¸ä¼šå†è¿›å…¥æ¡ä»¶åˆ¤æ–­è¯­å¥ã€‚çœ‹èµ·æ¥å¥½åƒæ²¡æœ‰é—®é¢˜ï¼Ÿä½†æ˜¯ï¼Œç”±äº useState æ˜¯åŸºäº Array+Cursor æ¥å®ç°çš„ï¼Œç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶å€™ï¼Œstate å’Œ cursor çš„å¯¹åº”å…³ç³»å¦‚ä¸‹è¡¨ï¼š</p>
  <table>
    <thead>
    <tr>
      <th>å˜é‡å</th>
      <th>cursor</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>num</td>
      <td>0</td>
    </tr>
    <tr>
      <td>unusedNum</td>
      <td>1</td>
    </tr>
    <tr>
      <td>num2</td>
      <td>2</td>
    </tr>
    </tbody>
  </table>
  <p>å½“ç‚¹å‡»äº‹ä»¶è§¦å‘å†æ¬¡æ¸²æŸ“ï¼Œå¹¶ä¸ä¼šè¿›å…¥æ¡ä»¶åˆ¤æ–­ä¸­çš„ useStateã€‚æ‰€ä»¥ï¼Œcursor=2 çš„æ—¶å€™å¯¹åº”çš„å˜é‡æ˜¯ num2ã€‚è€Œå…¶å® num2 å¯¹åº”çš„ cursor åº”è¯¥æ˜¯ 3ã€‚å°±ä¼šå¯¼è‡´<code>setNum2</code>å¹¶ä¸èµ·ä½œç”¨ã€‚</p>
  <p>åˆ°æ­¤ï¼Œè§£å†³äº†æ–‡ç« å¼€å¤´æå‡ºçš„ã€ŒğŸ¤”ï¸ ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å¾ªç¯ã€åˆ¤æ–­å†…éƒ¨ä½¿ç”¨ Hookã€ã€‚åœ¨ä½¿ç”¨ Hook çš„æ—¶å€™ï¼Œè¯·åœ¨å‡½æ•°ç»„ä»¶é¡¶éƒ¨ä½¿ç”¨ï¼</p>
  <h2 data-id="heading-3">useEffect çš„å®ç°åŸç†</h2>
  <p>åœ¨æ¢ç´¢ useEffect åŸç†çš„æ—¶å€™ï¼Œä¸€ç›´è¢«ä¸€ä¸ªé—®é¢˜å›°æ‰°ï¼šuseEffect ä½œç”¨å’Œç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿå½“ç„¶ï¼Œç”¨äºå‡½æ•°çš„å‰¯ä½œç”¨è¿™å¥è¯è°éƒ½ä¼šè®²ã€‚ä¸¾ä¸ªä¾‹å­å§ï¼š</p>
  <pre><code lang="scss" class="hljs language-scss copyable">function <span class="hljs-built_in">App</span>() {
  const <span class="hljs-selector-attr">[num, setNum]</span> = <span class="hljs-built_in">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-built_in">useEffect</span>(() =&gt; {
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥è¯·æ±‚åç«¯æ•°æ®</span>
    <span class="hljs-built_in">setTimeout</span>(() =&gt; {
      <span class="hljs-built_in">setNum</span>(num + <span class="hljs-number">1</span>);
    }, <span class="hljs-number">1000</span>);
  }, <span class="hljs-selector-attr">[]</span>);

  return &lt;<span class="hljs-selector-tag">div</span>&gt;{!num ? "è¯·æ±‚åç«¯æ•°æ®..." : `åç«¯æ•°æ®æ˜¯ ${num}`}&lt;/<span class="hljs-selector-tag">div</span>&gt;;
}
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>è¿™æ®µä»£ç ï¼Œè™½ç„¶è¿™æ ·ç»„ç»‡å¯è¯»æ€§æ›´é«˜ï¼Œæ¯•ç«Ÿå¯ä»¥å°†è¿™ä¸ªè¯·æ±‚ç†è§£ä¸ºå‡½æ•°çš„å‰¯ä½œç”¨ã€‚<strong>ä½†è¿™å¹¶ä¸æ˜¯å¿…è¦çš„</strong>ã€‚å®Œå…¨å¯ä»¥ä¸ä½¿ç”¨<code>useEffect</code>ï¼Œç›´æ¥ä½¿ç”¨<code>setTimeout</code>ï¼Œå¹¶ä¸”å®ƒçš„å›è°ƒå‡½æ•°ä¸­æ›´æ–°å‡½æ•°ç»„ä»¶çš„ stateã€‚</p>
  <p>åœ¨é˜…è¯»<a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fzh-hans%2Fa-complete-guide-to-useeffect%2F" title="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" ref="nofollow noopener noreferrer">A Complete Guide to useEffect</a>å’Œ<a target="_blank" href="https://link.juejin.cn?target=http%3A%2F%2Freact.html.cn%2Fdocs%2Fhooks-custom.html" title="http://react.html.cn/docs/hooks-custom.html" ref="nofollow noopener noreferrer">æ„å»ºä½ è‡ªå·±çš„ Hooks</a>ä¹‹åï¼Œæˆ‘æ‰ç†è§£ useEffect çš„å­˜åœ¨çš„å¿…è¦æ€§å’Œæ„ä¹‰ã€‚</p>
  <p>åœ¨ useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸‹æ¬¡æ¸²æŸ“æ—¶ï¼Œæ•°ç»„ä¸­çš„å…ƒç´ æ²¡å˜ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè§¦å‘è¿™ä¸ªå‰¯ä½œç”¨ï¼ˆå¯ä»¥ç±»æ¯” Class ç±»çš„å…³äº nextprops å’Œ prevProps çš„ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚å¥½å¤„æ˜¾ç„¶æ˜“è§ï¼Œ<strong>ç›¸æ¯”äºç›´æ¥è£¸å†™åœ¨å‡½æ•°ç»„ä»¶é¡¶å±‚ï¼ŒuseEffect èƒ½æ ¹æ®éœ€è¦ï¼Œé¿å…å¤šä½™çš„ render</strong>ã€‚</p>
  <p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¸åŒ…æ‹¬é”€æ¯å‰¯ä½œç”¨åŠŸèƒ½çš„ useEffect çš„ TypeScript å®ç°ï¼š</p>
  <pre><code lang="ini" class="hljs language-ini copyable">// è¿˜æ˜¯åˆ©ç”¨ Array + Cursorçš„æ€è·¯
const allDeps: any<span class="hljs-section">[]</span><span class="hljs-section">[]</span> = <span class="hljs-section">[]</span><span class="hljs-comment">;</span>
let effectCursor: <span class="hljs-attr">number</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

function useEffect(callback: () =&gt; void, deps: any<span class="hljs-section">[]</span>) {
  if (!allDeps<span class="hljs-section">[effectCursor]</span>) {
    // åˆæ¬¡æ¸²æŸ“ï¼šèµ‹å€¼ + è°ƒç”¨å›è°ƒå‡½æ•°
    allDeps<span class="hljs-section">[effectCursor]</span> = deps<span class="hljs-comment">;</span>
    ++effectCursor<span class="hljs-comment">;</span>
    callback()<span class="hljs-comment">;</span>
    return<span class="hljs-comment">;</span>
  }

  const <span class="hljs-attr">currenEffectCursor</span> = effectCursor<span class="hljs-comment">;</span>
  const <span class="hljs-attr">rawDeps</span> = allDeps[currenEffectCursor]<span class="hljs-comment">;</span>
  // æ£€æµ‹ä¾èµ–é¡¹æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå‘ç”Ÿå˜åŒ–éœ€è¦é‡æ–°render
  const <span class="hljs-attr">isChanged</span> = rawDeps.some(
    (dep: any, index: number) =&gt; dep !== deps<span class="hljs-section">[index]</span>
  )<span class="hljs-comment">;</span>
  if (isChanged) {
    callback()<span class="hljs-comment">;</span>
    allDeps<span class="hljs-section">[effectCursor]</span> = deps<span class="hljs-comment">; // æ„Ÿè°¢ juejin@carlzzz çš„æŒ‡æ­£</span>
  }
  ++effectCursor<span class="hljs-comment">;</span>
}

function render() {
  ReactDOM.render(&lt;App /&gt;, document.getElementById("root"))<span class="hljs-comment">;</span>
  <span class="hljs-attr">effectCursor</span> = <span class="hljs-number">0</span><span class="hljs-comment">; // æ³¨æ„å°† effectCursor é‡ç½®ä¸º0</span>
}
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>å¯¹äº useEffect çš„å®ç°ï¼Œé…åˆä¸‹é¢æ¡ˆä¾‹çš„ä½¿ç”¨ä¼šæ›´å®¹æ˜“ç†è§£ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ª useEffect ä¸­å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼Œå¹¶åœ¨æ¥å—æ•°æ®åï¼Œè°ƒç”¨ state çš„æ›´æ–°å‡½æ•°ï¼Œä¸ä¼šå‘ç”Ÿçˆ†æ ˆçš„æƒ…å†µã€‚</p>
  <pre><code lang="typescript" class="hljs language-typescript copyable"><span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [num, setNum] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> [num2] = useState &lt; <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">1</span>;

  <span class="hljs-comment">// å¤šæ¬¡è§¦å‘</span>
  <span class="hljs-comment">// æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œéƒ½ä¼šè§¦å‘ setNum å‡½æ•°</span>
  <span class="hljs-comment">// å‰¯ä½œç”¨æ£€æµ‹åˆ° num å˜åŒ–ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"num update: "</span>, num);
  }, [num]);

  <span class="hljs-comment">// ä»…ç¬¬ä¸€æ¬¡è§¦å‘</span>
  <span class="hljs-comment">// åªä¼šåœ¨compoentDidMountæ—¶ï¼Œè§¦å‘ä¸€æ¬¡</span>
  <span class="hljs-comment">// å‰¯ä½œç”¨å‡½æ•°ä¸ä¼šå¤šæ¬¡æ‰§è¡Œ</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"num2 update: "</span>, num2);
  }, [num2]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>num: {num}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num + 1)}&gt;åŠ  1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setNum(num - 1)}&gt;å‡ 1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><p>âš ï¸ useEffect ç¬¬ä¸€ä¸ªå›è°ƒå‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªç”¨äºé”€æ¯å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œç›¸å½“äº Class ç»„ä»¶çš„ unmount ç”Ÿå‘½å‘¨æœŸã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œæ²¡æœ‰è¿›è¡Œå®ç°ã€‚</p>
  <p>åœ¨è¿™ä¸€å°èŠ‚ä¸­ï¼Œå°è¯•è§£ç­”äº† ã€ŒğŸ¤”ï¸ useEffect çš„å®ç°åŸç†ã€å’Œ ã€ŒğŸ¤”ï¸ useEffect çš„åº”ç”¨åœºæ™¯ã€è¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p>
  <h2 data-id="heading-4">Class VS Hooks</h2>
  <p>è™½ç„¶ Hooks çœ‹èµ·æ¥æ›´é…·ç‚«ï¼Œæ›´ç®€æ´ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­æˆ‘æ›´å€¾å‘äºä½¿ç”¨ Class æ¥å£°æ˜ç»„ä»¶ã€‚ä¸¤ç§æ–¹æ³•çš„å¯¹æ¯”å¦‚ä¸‹ï¼š</p>
  <table>
    <thead>
    <tr>
      <th>Class</th>
      <th>Hooks</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>ä»£ç é€»è¾‘æ¸…æ™°ï¼ˆæ„é€ å‡½æ•°ã€componentDidMount ç­‰ï¼‰</td>
      <td>éœ€è¦é…åˆå˜é‡åå’Œæ³¨é‡Š</td>
    </tr>
    <tr>
      <td>ä¸å®¹æ˜“å†…å­˜æ³„æ¼</td>
      <td>å®¹æ˜“å‘ç”Ÿå†…å­˜æ³„æ¼</td>
    </tr>
    </tbody>
  </table>
  <p>æ€»çš„æ¥è¯´ï¼ŒHooks å¯¹ä»£ç ç¼–å†™çš„è¦æ±‚è¾ƒé«˜ï¼Œåœ¨æ²¡æœ‰æœ‰æ•ˆæœºåˆ¶ä¿è¯ä»£ç å¯è¯»æ€§ã€è§„é¿é£é™©çš„æƒ…å†µä¸‹ï¼ŒClass ä¾ç„¶æ˜¯æˆ‘çš„é¦–é€‰ã€‚å…³äºå†…å­˜æ³„æ¼ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼ˆç›®å‰è¿˜æ²¡æ‰¾åˆ°æ–¹æ³•è§„é¿è¿™ç§å‘å…¨å±€ä¼ é€’çŠ¶æ€æ›´æ–°å‡½æ•°çš„åšæ³•ï¼‰ï¼š</p>
  <pre><code lang="javascript" class="hljs language-javascript copyable"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>;

<span class="hljs-keyword">let</span> <span class="hljs-attr">func</span>: any;
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">typeof</span> func === <span class="hljs-string">"function"</span> &amp;&amp; <span class="hljs-title function_">func</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>());
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"interval"</span>);
}, <span class="hljs-number">1000</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [num, setNum] = useState &lt; number &gt; <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> func !== <span class="hljs-string">"function"</span>) {
    func = setNum;
  }
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{num}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) {
  <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"root"</span>));
}

<span class="hljs-title function_">render</span>();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre><h2 data-id="heading-5">å‚è€ƒé“¾æ¥</h2>
  <ul>
    <li><a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2F%40ryardley%2Freact-hooks-not-magic-just-arrays-cd4f1857236e" title="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" ref="nofollow noopener noreferrer">React hooks: not magic, just arrays</a></li>
    <li><a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fzh-hans%2Fa-complete-guide-to-useeffect%2F" title="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" ref="nofollow noopener noreferrer">A Complete Guide to useEffect</a></li>
    <li><a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fzh-hans%2Fa-complete-guide-to-useeffect%2F" title="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" ref="nofollow noopener noreferrer">useEffect å®Œæ•´æŒ‡å—</a></li>
    <li><a target="_blank" href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrickspert%2Fblog%2Fissues%2F26" title="https://github.com/brickspert/blog/issues/26" ref="nofollow noopener noreferrer">React Hooks åŸç†</a>: <code>useEffect</code>å®ç°æœ‰é—®é¢˜ï¼Œå›è°ƒå‡½æ•°è°ƒç”¨ state çš„æ›´æ–°å‡½æ•°ï¼Œä¼šçˆ†æ ˆ</li>
  </ul>
  <p>æ–‡ç« ä¸­å¤šæœ‰è§è§£ä¸åˆ°å½“ä¹‹å¤„ï¼Œæ¬¢è¿è®¨è®ºå’ŒæŒ‡æ­£ã€‚</p>
</div>
